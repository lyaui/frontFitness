{"remainingRequest":"/Users/huangpei-yu/Front-Gym/node_modules/thread-loader/dist/cjs.js!/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js!/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/Front-Gym/src/views/CheckoutInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/Front-Gym/src/views/CheckoutInfo.vue","mtime":1580813992382},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { fb, db } from \"@/firebase/init\";\nimport Swal from \"sweetalert2\";\nimport StepBar from \"@/components/StepBar\";\nimport moment from \"moment\";\nimport JsBarcode from \"jsbarcode\";\nexport default {\n  components: {\n    StepBar: StepBar\n  },\n  data: function data() {\n    return {\n      status: \"checkout\",\n      paymentId: null,\n      payment: {},\n      remainZero: []\n    };\n  },\n  methods: {\n    barCode: function barCode() {\n      setTimeout(function () {\n        JsBarcode(\"#barcode\", \"frontFitness\", {\n          format: \"CODE39\",\n          lineColor: \"#707070\",\n          font: \"Russo+One\",\n          fontSize: 15,\n          width: 1.1,\n          height: 40,\n          displayValue: true\n        });\n      }, 1000);\n    },\n    checkOut: function checkOut() {\n      var _this = this;\n\n      //確認剩餘名額，如果名額已經為0，則將該課程推入remainZero中\n      var vm = this;\n      var coursesTitle = vm.payment.courses.map(function (course) {\n        return course.title;\n      });\n      coursesTitle.forEach(function (course) {\n        return db.collection(\"courses\").where(\"title\", \"==\", course).get().then(function (snapshot) {\n          snapshot.forEach(function (doc) {\n            if (doc.data().remainQuantity === 0) {\n              vm.remainZero.push(doc.data().title);\n            }\n\n            _this.$store.commit(\"changeRemains\", vm.remainZero);\n          });\n\n          if (vm.remainZero.length > 0) {\n            //如果有課程已額滿跳出警示\n            var titles = vm.remainZero.join(\" 和 \");\n            Swal.fire({\n              title: \" \".concat(titles, \" \\u5DF2\\u984D\\u6EFF\"),\n              text: \"\\u8ACB\\u9078\\u64C7\\u5176\\u4ED6\\u8AB2\\u7A0B\",\n              type: \"warning\",\n              confirmButtonColor: \"#ff5721\"\n            }).then(function (result) {\n              //刪除該筆訂單\n              db.collection(\"payments\").doc(vm.paymentId).delete().then(function () {\n                return (//返回購物車頁面\n                  vm.$router.push(\"/cart\")\n                );\n              });\n            });\n          } else {\n            //課程都沒有額滿的情況，更新課程數量\n            _this.payment.courses.forEach(function (course) {\n              db.collection(\"courses\").doc(course.id).update({\n                remainQuantity: course.remainQuantity - 1\n              }).then().catch();\n            }); // 更改訂單付款狀態\n\n\n            db.collection(\"payments\").doc(_this.paymentId).update({\n              status: true\n            }).then().catch(); // 清空購物車\n\n            _this.$store.commit(\"checkout\"); // 結帳成功提示\n\n\n            _this.payment.status = true;\n            _this.status = \"success\";\n            Swal.fire({\n              type: \"success\",\n              title: \"\\u4ED8\\u6B3E\\u6210\\u529F\\uFF0C\\u611F\\u8B1D\\u8CFC\\u8CB7\\uFF01\",\n              showConfirmButton: false,\n              timer: 1000\n            }).then(function (result) {\n              //發票條碼\n              _this.barCode();\n            });\n          }\n        });\n      });\n    }\n  },\n  created: function created() {\n    var _this2 = this;\n\n    this.paymentId = this.$route.params.paymentId;\n    db.collection(\"payments\").doc(this.paymentId).get().then(function (doc) {\n      return _this2.payment = doc.data();\n    });\n  }\n};",{"version":3,"sources":["CheckoutInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <main class=\"courses-main\">\n      <div class=\"container\">\n        <step-bar :status=\"status\"></step-bar>\n        <div class=\"checkout\">\n          <div class=\"checkout__info\">\n            <div class=\"checkout-payment checkout-payment__courses mb-sm\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"fas fa-money-check fa-lg\"></i> 結帳金額\n              </div>\n              <table class=\"checkout-table\">\n                <thead>\n                  <tr>\n                    <th>課程名稱</th>\n                    <th>購買方案</th>\n                    <th>原價</th>\n                    <th>售價</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"course in payment.courses\" :key=\"course.title\">\n                    <td>{{course.title}}</td>\n                    <td>\n                      <template v-if=\"course.discount\">精選優惠</template>\n                      <template v-else>課程售價</template>\n                    </td>\n                    <td style=\"text-align:right\">{{course.price|currency}}</td>\n\n                    <td style=\"text-align:right\">\n                      <template v-if=\"course.discount\">{{course.price-100|currency}}</template>\n                      <template v-else>{{course.price|currency}}</template>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n              <div class=\"checkout-payment__total\">\n                實付金額\n                <b class=\"ml-sm\">{{payment.total|currency}}</b>\n              </div>\n            </div>\n            <div class=\"checkout-payment checkout-payment__user\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"far fa-address-card fa-lg\"></i> 付款資訊\n              </div>\n              <div class=\"checkout-payment__invoice\">\n                <div class>\n                  <b>付款方式</b>\n                  <p>{{payment.payWay}}</p>\n                </div>\n                <div class>\n                  <b>發票資訊</b>\n                  <p>聯絡人：{{payment.name}}</p>\n                  <p>聯絡電子信箱：{{payment.email}}</p>\n                  <p>聯絡電話：{{payment.phone}}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"checkout__summary\" v-if=\"!payment.status\">\n            <div class=\"checkout__summary-title heading-tertiary--dark\">訂單明細</div>\n\n            <div class=\"checkout__summary-price\">\n              <div>原價</div>\n              <div>{{$store.state.totalOrigin|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-price\" v-if=\"$store.state.coupon\">\n              <div>優惠券折扣</div>\n              <div>-{{$store.state.discount|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-total\">\n              <div>總計</div>\n              <h3>{{$store.state.total|currency}}</h3>\n            </div>\n            <button\n              class=\"swal2-confirm swal2-styled checkout__coupon-btn\"\n              style=\"display: inline-block; background-color: rgb(255, 87, 33); border-left-color: rgb(255, 87, 33); border-right-color: rgb(255, 87, 33);\"\n              @click.prevent=\"checkOut()\"\n            >確認付款</button>\n          </div>\n          <div class=\"checkout__summary\" v-if=\"payment.status\">\n            <div class=\"mb-sm heading-tertiary--dark\">付款成功 感謝購買</div>\n\n            <img class=\"mb-sm mt-sm\" width=\"60%\" src=\"@/assets/img/checked.svg\">\n            <ul class=\"checkout__summary-list\">\n              <li class=\"checkout__summary-item\">訂單編號：{{paymentId}}</li>\n              <li class=\"checkout__summary-item\">購買日期：{{payment.timestamp}}</li>\n              <li class=\"checkout__summary-item\">付款金額：{{payment.total|currency}}</li>\n            </ul>\n\n            <svg id=\"barcode\" class=\"mt-sm\"></svg>\n          </div>\n        </div>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script>\nimport { fb, db } from \"@/firebase/init\";\nimport Swal from \"sweetalert2\";\nimport StepBar from \"@/components/StepBar\";\nimport moment from \"moment\";\nimport JsBarcode from \"jsbarcode\";\n\nexport default {\n  components: {\n    StepBar\n  },\n  data() {\n    return {\n      status: \"checkout\",\n      paymentId: null,\n      payment: {},\n      remainZero: []\n    };\n  },\n\n  methods: {\n    barCode() {\n      setTimeout(function() {\n        JsBarcode(\"#barcode\", \"frontFitness\", {\n          format: \"CODE39\",\n          lineColor: \"#707070\",\n          font: \"Russo+One\",\n          fontSize: 15,\n          width: 1.1,\n          height: 40,\n          displayValue: true\n        });\n      }, 1000);\n    },\n    checkOut() {\n      //確認剩餘名額，如果名額已經為0，則將該課程推入remainZero中\n      const vm = this;\n      let coursesTitle = vm.payment.courses.map(course => course.title);\n\n      coursesTitle.forEach(course =>\n        db\n          .collection(\"courses\")\n          .where(\"title\", \"==\", course)\n          .get()\n          .then(snapshot => {\n            snapshot.forEach(doc => {\n              if (doc.data().remainQuantity === 0) {\n                vm.remainZero.push(doc.data().title);\n              }\n              this.$store.commit(\"changeRemains\", vm.remainZero);\n            });\n\n            if (vm.remainZero.length > 0) {\n              //如果有課程已額滿跳出警示\n              let titles = vm.remainZero.join(\" 和 \");\n              Swal.fire({\n                title: ` ${titles} 已額滿`,\n                text: `請選擇其他課程`,\n                type: \"warning\",\n                confirmButtonColor: \"#ff5721\"\n              }).then(result => {\n                //刪除該筆訂單\n                db.collection(\"payments\")\n                  .doc(vm.paymentId)\n                  .delete()\n                  .then(() =>\n                    //返回購物車頁面\n                    vm.$router.push(\"/cart\")\n                  );\n              });\n            } else {\n              //課程都沒有額滿的情況，更新課程數量\n              this.payment.courses.forEach(course => {\n                db.collection(\"courses\")\n                  .doc(course.id)\n                  .update({\n                    remainQuantity: course.remainQuantity - 1\n                  })\n                  .then()\n                  .catch();\n              });\n              // 更改訂單付款狀態\n              db.collection(\"payments\")\n                .doc(this.paymentId)\n                .update({\n                  status: true\n                })\n                .then()\n                .catch();\n              // 清空購物車\n              this.$store.commit(\"checkout\");\n\n              // 結帳成功提示\n              this.payment.status = true;\n              this.status = \"success\";\n              Swal.fire({\n                type: \"success\",\n                title: `付款成功，感謝購買！`,\n                showConfirmButton: false,\n                timer: 1000\n              }).then(result => {\n                //發票條碼\n                this.barCode();\n              });\n            }\n          })\n      );\n    }\n  },\n  created() {\n    this.paymentId = this.$route.params.paymentId;\n    db.collection(\"payments\")\n      .doc(this.paymentId)\n      .get()\n      .then(doc => (this.payment = doc.data()));\n  }\n};\n</script>"],"sourceRoot":"src/views"}]}