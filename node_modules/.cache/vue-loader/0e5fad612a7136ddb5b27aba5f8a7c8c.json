{"remainingRequest":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/Front-Gym/src/views/Checkout.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/Front-Gym/src/views/Checkout.vue","mtime":1580813959247},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport $ from \"jquery\";\nimport { fb, db } from \"@/firebase/init\";\nimport Swal from \"sweetalert2\";\nimport StepBar from \"@/components/StepBar\";\nimport { required, email, numeric } from \"vuelidate/lib/validators\";\n\nexport default {\n  components: {\n    StepBar\n  },\n  data() {\n    return {\n      status: \"checkout\",\n      paymentId: null,\n      payment: {\n        timestamp: null,\n        userId: null,\n        payWay: null,\n        name: null,\n        email: null,\n        phone: null,\n        remark: null,\n        courses: this.$store.state.cart,\n        total: this.$store.state.total,\n        status: false\n      }\n    };\n  },\n  validations: {\n    payment: {\n      payWay: {\n        required\n      },\n      name: {\n        required\n      },\n      email: {\n        required,\n        email\n      },\n      phone: {\n        required,\n        numeric\n      }\n    }\n  },\n\n  methods: {\n    //確認資料是否正確\n    formCheck() {\n      this.$v.$touch();\n      if (this.$v.$invalid) {\n        Swal.fire({\n          title: \"請正確填寫必要資訊\",\n          type: \"warning\",\n          showConfirmButton: false,\n          timer: 800\n        });\n      } else {\n        this.checkOut();\n      }\n    },\n    checkOut() {\n      if (this.$store.state.cart.length === 0) {\n        Swal.fire({\n          title: \"請至少選擇一門課程\",\n          type: \"warning\",\n          showConfirmButton: false,\n          timer: 800\n        });\n      } else {\n        this.payment.courses = this.payment.courses.map(course => ({\n          title: course.title,\n          discount: course.discount,\n          price: course.price,\n          sellingPrice: course.discount\n            ? course.price - this.$store.state.discount\n            : course.price\n        }));\n\n        this.payment.timestamp = Date.now();\n        db.collection(\"payments\")\n          .add(this.payment)\n          .then(docRef => {\n            this.paymentId = docRef.id;\n            this.$router.push(`/checkout/${this.paymentId}`);\n          });\n      }\n    }\n  },\n  created() {\n    this.payment.userId = fb.auth().currentUser.uid;\n    this.user = db\n      .collection(\"users\")\n      .doc(this.payment.userId)\n      .get()\n      .then(data => {\n        const user = data.data();\n        this.payment.name = user.name;\n        this.payment.email = user.email;\n      });\n  }\n};\n",{"version":3,"sources":["Checkout.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgJA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Checkout.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <main class=\"courses-main\">\n      <div class=\"container\">\n        <step-bar :status=\"status\"></step-bar>\n        <div class=\"checkout\">\n          <div class=\"checkout__info mb-sm\">\n            <div class=\"checkout-form mb-sm\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"far fa-credit-card fa-lg\"></i>\n                付款方式\n              </div>\n\n              <div class=\"form__group\">\n                <select\n                  class=\"form__input\"\n                  v-model=\"payment.payWay\"\n                  :class=\"{'form__input--warning': $v.payment.payWay.$error}\"\n                >\n                  <option :value=\"null\" disabled>--請選擇付款方式--</option>\n                  <option value=\"信用卡\">信用卡</option>\n                  <option value=\"ATM轉帳\">ATM轉帳</option>\n                  <option value=\"超商付款\">超商付款</option>\n                </select>\n                <template v-if=\"$v.payment.payWay.$dirty\">\n                  <span class=\"text-warning\" v-if=\"!$v.payment.payWay.required\">請選擇付款方式</span>\n                </template>\n              </div>\n            </div>\n\n            <div class=\"checkout-form\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"fas fa-cash-register fa-lg\"></i>\n                發票選項\n              </div>\n              <p class=\"checkout-form__text mb-sm\">\n                以下資訊只用於開立發票，不會在其他頁面顯示。發票開立後不可更改，請確認資訊是否都填寫正確！\n                <br>（\n                <span class=\"text-highlight\">*</span> 為必填欄位）\n              </p>\n\n              <form class=\"checkout-form__form\">\n                <div class=\"form__row\">\n                  <div class=\"form__group\">\n                    <label class=\"form__label\" for>\n                      姓名\n                      <span class=\"text-highlight\">*</span>\n                    </label>\n\n                    <input\n                      class=\"form__input\"\n                      v-model.trim=\"$v.payment.name.$model\"\n                      placeholder=\"請填入真實姓名\"\n                      type=\"text\"\n                      :class=\"{'form__input--warning': $v.payment.name.$error}\"\n                    >\n                    <template v-if=\"$v.payment.name.$dirty\">\n                      <span class=\"text-warning\" v-if=\"!$v.payment.name.required\">姓名為必填欄位</span>\n                    </template>\n                  </div>\n                  <div class=\"form__group\">\n                    <label class=\"form__label\" for>\n                      聯絡電子信箱\n                      <span class=\"text-highlight\">*</span>\n                    </label>\n                    <input\n                      class=\"form__input\"\n                      v-model.trim=\"$v.payment.email.$model\"\n                      placeholder=\"請填入電子信箱\"\n                      type=\"email\"\n                      :class=\"{'form__input--warning': $v.payment.email.$error}\"\n                    >\n                    <template v-if=\"$v.payment.email.$dirty\">\n                      <span class=\"text-warning\" v-if=\"!$v.payment.email.required\">信箱為必填欄位</span>\n                      <span class=\"text-warning\" v-if=\"!$v.payment.email.email\">請輸入正確信箱格式</span>\n                    </template>\n                  </div>\n                </div>\n                <div class=\"form__row\">\n                  <div class=\"form__group\">\n                    <label class=\"form__label\" for>\n                      聯絡電話\n                      <span class=\"text-highlight\">*</span>\n                    </label>\n                    <input\n                      class=\"form__input\"\n                      v-model.trim.number=\"$v.payment.phone.$model\"\n                      placeholder=\"請填入聯絡電話\"\n                      type=\"tel\"\n                      :class=\"{'form__input--warning': $v.payment.phone.$error}\"\n                    >\n                    <template v-if=\"$v.payment.phone.$dirty\">\n                      <span class=\"text-warning\" v-if=\"!$v.payment.phone.required\">電話為必填欄位</span>\n                      <span class=\"text-warning\" v-if=\"!$v.payment.phone.numeric\">電話號碼必為數字</span>\n                    </template>\n                  </div>\n                </div>\n                <div class=\"form__row\">\n                  <div class=\"form__group\">\n                    <label class=\"form__label\">備註</label>\n\n                    <textarea\n                      class=\"form__input\"\n                      v-model=\"payment.remark\"\n                      placeholder=\"如有任何備註事項請註明\"\n                      cols=\"30\"\n                      rows=\"20\"\n                      style=\"height:100px\"\n                    ></textarea>\n                  </div>\n                </div>\n              </form>\n            </div>\n          </div>\n\n          <div class=\"checkout__summary\">\n            <div class=\"checkout__summary-title heading-tertiary--dark\">訂單明細</div>\n\n            <div class=\"checkout__summary-price\">\n              <div>原價</div>\n              <div>{{$store.state.totalOrigin|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-price\" v-if=\"$store.state.coupon\">\n              <div>優惠券折扣</div>\n              <div>-{{$store.state.totalDiscount|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-total\">\n              <div>總計</div>\n              <h3>{{$store.state.total|currency}}</h3>\n            </div>\n            <button\n              type=\"submit\"\n              class=\"swal2-confirm swal2-styled checkout__coupon-btn mt-sm\"\n              style=\"display: inline-block; background-color: rgb(255, 87, 33); border-left-color: rgb(255, 87, 33); border-right-color: rgb(255, 87, 33);\"\n              @click.prevent=\"formCheck()\"\n            >確認送出</button>\n          </div>\n        </div>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script>\nimport $ from \"jquery\";\nimport { fb, db } from \"@/firebase/init\";\nimport Swal from \"sweetalert2\";\nimport StepBar from \"@/components/StepBar\";\nimport { required, email, numeric } from \"vuelidate/lib/validators\";\n\nexport default {\n  components: {\n    StepBar\n  },\n  data() {\n    return {\n      status: \"checkout\",\n      paymentId: null,\n      payment: {\n        timestamp: null,\n        userId: null,\n        payWay: null,\n        name: null,\n        email: null,\n        phone: null,\n        remark: null,\n        courses: this.$store.state.cart,\n        total: this.$store.state.total,\n        status: false\n      }\n    };\n  },\n  validations: {\n    payment: {\n      payWay: {\n        required\n      },\n      name: {\n        required\n      },\n      email: {\n        required,\n        email\n      },\n      phone: {\n        required,\n        numeric\n      }\n    }\n  },\n\n  methods: {\n    //確認資料是否正確\n    formCheck() {\n      this.$v.$touch();\n      if (this.$v.$invalid) {\n        Swal.fire({\n          title: \"請正確填寫必要資訊\",\n          type: \"warning\",\n          showConfirmButton: false,\n          timer: 800\n        });\n      } else {\n        this.checkOut();\n      }\n    },\n    checkOut() {\n      if (this.$store.state.cart.length === 0) {\n        Swal.fire({\n          title: \"請至少選擇一門課程\",\n          type: \"warning\",\n          showConfirmButton: false,\n          timer: 800\n        });\n      } else {\n        this.payment.courses = this.payment.courses.map(course => ({\n          title: course.title,\n          discount: course.discount,\n          price: course.price,\n          sellingPrice: course.discount\n            ? course.price - this.$store.state.discount\n            : course.price\n        }));\n\n        this.payment.timestamp = Date.now();\n        db.collection(\"payments\")\n          .add(this.payment)\n          .then(docRef => {\n            this.paymentId = docRef.id;\n            this.$router.push(`/checkout/${this.paymentId}`);\n          });\n      }\n    }\n  },\n  created() {\n    this.payment.userId = fb.auth().currentUser.uid;\n    this.user = db\n      .collection(\"users\")\n      .doc(this.payment.userId)\n      .get()\n      .then(data => {\n        const user = data.data();\n        this.payment.name = user.name;\n        this.payment.email = user.email;\n      });\n  }\n};\n</script>"]}]}