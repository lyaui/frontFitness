{"remainingRequest":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/Front-Gym/src/views/CheckoutInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/Front-Gym/src/views/CheckoutInfo.vue","mtime":1583327721977},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { fb, db } from \"@/firebase/init\";\nimport Swal from \"sweetalert2\";\nimport StepBar from \"@/components/StepBar\";\nimport moment from \"moment\";\nimport JsBarcode from \"jsbarcode\";\n\nexport default {\n  components: {\n    StepBar\n  },\n  data() {\n    return {\n      status: \"checkout\",\n      paymentId: null,\n      payment: {},\n      remainZero: []\n    };\n  },\n\n  methods: {\n    barCode() {\n      setTimeout(function() {\n        JsBarcode(\"#barcode\", \"frontFitness\", {\n          format: \"CODE39\",\n          lineColor: \"#707070\",\n          font: \"Russo+One\",\n          fontSize: 15,\n          width: 1.1,\n          height: 40,\n          displayValue: true\n        });\n      }, 1000);\n    },\n    checkOut() {\n      //確認剩餘名額，如果名額已經為0，則將該課程推入remainZero中\n      const vm = this;\n      let coursesTitle = vm.payment.courses.map(course => course.title);\n\n      coursesTitle.forEach(course =>\n        db\n          .collection(\"courses\")\n          .where(\"title\", \"==\", course)\n          .get()\n          .then(snapshot => {\n            snapshot.forEach(doc => {\n              if (doc.data().remainQuantity === 0) {\n                vm.remainZero.push(doc.data().title);\n              }\n              this.$store.commit(\"changeRemains\", vm.remainZero);\n            });\n\n            if (vm.remainZero.length > 0) {\n              //如果有課程已額滿跳出警示\n              let titles = vm.remainZero.join(\" 和 \");\n              Swal.fire({\n                title: ` ${titles} 已額滿`,\n                text: `請選擇其他課程`,\n                type: \"warning\",\n                confirmButtonColor: \"#ff5721\"\n              }).then(result => {\n                //刪除該筆訂單\n                db.collection(\"payments\")\n                  .doc(vm.paymentId)\n                  .delete()\n                  .then(() =>\n                    //返回購物車頁面\n                    vm.$router.push(\"/cart\")\n                  );\n              });\n            } else {\n              //課程都沒有額滿的情況，更新課程數量\n              this.payment.courses.forEach(course => {\n                db.collection(\"courses\")\n                  .doc(course.id)\n                  .update({\n                    remainQuantity: course.remainQuantity - 1\n                  })\n                  .then()\n                  .catch();\n              });\n              // 更改訂單付款狀態\n              db.collection(\"payments\")\n                .doc(this.paymentId)\n                .update({\n                  status: true\n                })\n                .then()\n                .catch();\n              // 清空購物車\n              this.$store.commit(\" clearCart\");\n\n              // 結帳成功提示\n              this.$toasted.success(`付款成功，感謝購買！`, {\n                duration: 2000\n              });\n              //發票條碼\n              this.barCode();\n            }\n          })\n      );\n    }\n  },\n  created() {\n    this.paymentId = this.$route.params.paymentId;\n    db.collection(\"payments\")\n      .doc(this.paymentId)\n      .get()\n      .then(doc => (this.payment = doc.data()));\n  }\n};\n",{"version":3,"sources":["CheckoutInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CheckoutInfo.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <main class=\"courses-main\">\n      <div class=\"container\">\n        <step-bar :status=\"status\"></step-bar>\n        <div class=\"checkout\">\n          <div class=\"checkout__info\">\n            <div class=\"checkout-payment checkout-payment__courses mb-sm\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"fas fa-money-check fa-lg\"></i> 結帳金額\n              </div>\n              <table class=\"checkout-table\">\n                <thead>\n                  <tr>\n                    <th>課程名稱</th>\n                    <th>購買方案</th>\n                    <th>原價</th>\n                    <th>售價</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"course in payment.courses\" :key=\"course.title\">\n                    <td>{{course.title}}</td>\n                    <td>\n                      <template v-if=\"course.discount\">精選優惠</template>\n                      <template v-else>課程售價</template>\n                    </td>\n                    <td style=\"text-align:right\">{{course.price|currency}}</td>\n\n                    <td style=\"text-align:right\">\n                      <template v-if=\"course.discount\">{{course.price-100|currency}}</template>\n                      <template v-else>{{course.price|currency}}</template>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n              <div class=\"checkout-payment__total\">\n                實付金額\n                <b class=\"ml-sm\">{{payment.total|currency}}</b>\n              </div>\n            </div>\n            <div class=\"checkout-payment checkout-payment__user\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"far fa-address-card fa-lg\"></i> 付款資訊\n              </div>\n              <div class=\"checkout-payment__invoice\">\n                <div class>\n                  <b>付款方式</b>\n                  <p>{{payment.payWay}}</p>\n                </div>\n                <div class>\n                  <b>發票資訊</b>\n                  <p>聯絡人：{{payment.name}}</p>\n                  <p>聯絡電子信箱：{{payment.email}}</p>\n                  <p>聯絡電話：{{payment.phone}}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"checkout__summary\" v-if=\"!payment.status\">\n            <div class=\"checkout__summary-title heading-tertiary--dark\">訂單明細</div>\n\n            <div class=\"checkout__summary-price\">\n              <div>原價</div>\n              <div>{{$store.state.totalOrigin|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-price\" v-if=\"$store.state.coupon\">\n              <div>優惠券折扣</div>\n              <div>-{{$store.state.discount|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-total\">\n              <div>總計</div>\n              <h3>{{$store.state.total|currency}}</h3>\n            </div>\n            <button\n              class=\"btn btn-primary\"\n              style=\"display: inline-block; background-color: rgb(255, 87, 33); border-left-color: rgb(255, 87, 33); border-right-color: rgb(255, 87, 33);\"\n              @click.prevent=\"checkOut()\"\n            >確認付款</button>\n          </div>\n          <div class=\"checkout__summary\" v-if=\"payment.status\">\n            <div class=\"mb-sm heading-tertiary--dark\">付款成功 感謝購買</div>\n\n            <img class=\"mb-sm mt-sm\" width=\"60%\" src=\"@/assets/img/checked.svg\">\n            <ul class=\"checkout__summary-list\">\n              <li class=\"checkout__summary-item\">訂單編號：{{paymentId}}</li>\n              <li class=\"checkout__summary-item\">購買日期：{{payment.timestamp}}</li>\n              <li class=\"checkout__summary-item\">付款金額：{{payment.total|currency}}</li>\n            </ul>\n\n            <svg id=\"barcode\" class=\"mt-sm\"></svg>\n          </div>\n        </div>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script>\nimport { fb, db } from \"@/firebase/init\";\nimport Swal from \"sweetalert2\";\nimport StepBar from \"@/components/StepBar\";\nimport moment from \"moment\";\nimport JsBarcode from \"jsbarcode\";\n\nexport default {\n  components: {\n    StepBar\n  },\n  data() {\n    return {\n      status: \"checkout\",\n      paymentId: null,\n      payment: {},\n      remainZero: []\n    };\n  },\n\n  methods: {\n    barCode() {\n      setTimeout(function() {\n        JsBarcode(\"#barcode\", \"frontFitness\", {\n          format: \"CODE39\",\n          lineColor: \"#707070\",\n          font: \"Russo+One\",\n          fontSize: 15,\n          width: 1.1,\n          height: 40,\n          displayValue: true\n        });\n      }, 1000);\n    },\n    checkOut() {\n      //確認剩餘名額，如果名額已經為0，則將該課程推入remainZero中\n      const vm = this;\n      let coursesTitle = vm.payment.courses.map(course => course.title);\n\n      coursesTitle.forEach(course =>\n        db\n          .collection(\"courses\")\n          .where(\"title\", \"==\", course)\n          .get()\n          .then(snapshot => {\n            snapshot.forEach(doc => {\n              if (doc.data().remainQuantity === 0) {\n                vm.remainZero.push(doc.data().title);\n              }\n              this.$store.commit(\"changeRemains\", vm.remainZero);\n            });\n\n            if (vm.remainZero.length > 0) {\n              //如果有課程已額滿跳出警示\n              let titles = vm.remainZero.join(\" 和 \");\n              Swal.fire({\n                title: ` ${titles} 已額滿`,\n                text: `請選擇其他課程`,\n                type: \"warning\",\n                confirmButtonColor: \"#ff5721\"\n              }).then(result => {\n                //刪除該筆訂單\n                db.collection(\"payments\")\n                  .doc(vm.paymentId)\n                  .delete()\n                  .then(() =>\n                    //返回購物車頁面\n                    vm.$router.push(\"/cart\")\n                  );\n              });\n            } else {\n              //課程都沒有額滿的情況，更新課程數量\n              this.payment.courses.forEach(course => {\n                db.collection(\"courses\")\n                  .doc(course.id)\n                  .update({\n                    remainQuantity: course.remainQuantity - 1\n                  })\n                  .then()\n                  .catch();\n              });\n              // 更改訂單付款狀態\n              db.collection(\"payments\")\n                .doc(this.paymentId)\n                .update({\n                  status: true\n                })\n                .then()\n                .catch();\n              // 清空購物車\n              this.$store.commit(\" clearCart\");\n\n              // 結帳成功提示\n              this.$toasted.success(`付款成功，感謝購買！`, {\n                duration: 2000\n              });\n              //發票條碼\n              this.barCode();\n            }\n          })\n      );\n    }\n  },\n  created() {\n    this.paymentId = this.$route.params.paymentId;\n    db.collection(\"payments\")\n      .doc(this.paymentId)\n      .get()\n      .then(doc => (this.payment = doc.data()));\n  }\n};\n</script>"]}]}