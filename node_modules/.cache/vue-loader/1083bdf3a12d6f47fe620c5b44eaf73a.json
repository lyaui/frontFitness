{"remainingRequest":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/Front-Gym/src/components/Comments.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/Front-Gym/src/components/Comments.vue","mtime":1584953415801},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport StarRating from 'vue-star-rating';\nimport moment from 'moment';\n\nexport default {\n  name: 'Comments',\n  components: {\n    StarRating,\n  },\n  props: ['comments', 'currentUser', 'courseId'],\n  data() {\n    return {\n      comment: {\n        comment: null,\n        rating: null,\n      },\n      inputStatus: '新留言',\n      inputShow: true,\n      tempComment: null,\n    };\n  },\n  computed: {\n    // 計算平均分數\n    avgRating() {\n      if (this.comments.length === 0) {\n        return 0;\n      }\n      const avg = this.comments\n        .map((comment) => comment.rating)\n        .reduce((acc, cur) => acc + cur) / this.comments.length;\n      return parseFloat(avg.toFixed(1));\n    },\n    // 計算每個bar\n    ratingPercents() {\n      let percents = [0, 0, 0, 0, 0];\n      if (this.comments.length === 0) {\n        return percents;\n      }\n      const ratings = this.comments.map((item) => item.rating); // [5,3,3]\n      // 計算每個rating出現比率\n      percents = percents.map(\n        (item, index) => (item = ratings.filter((rating) => rating === index + 1).length)\n          / ratings.length,\n      );\n      // 換算百分比\n      return percents.map((num) => parseFloat(num.toFixed(2)) * 100).reverse();\n    },\n  },\n  watch: {\n    // 若平均評價改變則更新資料庫資料\n    avgRating() {\n      const course = { ...this.$store.state.courses.course };\n      course.avgRating = this.avgRating;\n      this.$store.dispatch('courses/updateCourse', {\n        id: this.courseId,\n        course,\n      });\n    },\n  },\n  methods: {\n    time(num) {\n      return moment(num).format('YYYY/MM/DD HH:mm');\n    },\n    alertLogReg() {\n      if (!this.currentUser) {\n        this.$toasted.info('請先 註冊/登入 以進行評價', {\n          duration: 2000,\n        });\n      }\n    },\n\n    // 新增評價\n    addComment() {\n      if (this.comment.rating && this.comment.comment) {\n        this.comment.user = this.currentUser.profile.userId;\n        this.comment.toId = this.courseId;\n        this.$store\n          .dispatch('comments/createComment', {\n            comment: this.comment,\n            user: this.currentUser,\n          })\n          .then(() => {\n            this.$toasted.success('已收到您的評價', {\n              duration: 2000,\n            });\n            this.inputStatus = '新留言';\n            this.inputShow = !this.inputShow;\n          });\n      } else {\n        this.$toasted.error('請 選取分數 與 留下評論 再送出', {\n          duration: 2000,\n        });\n      }\n    },\n\n    updateComment() {\n      if (this.comment.rating && this.comment.comment) {\n        this.$store\n          .dispatch('comments/updateComment', this.comment)\n          .then(() => {\n            this.$toasted.success('成功修改評價', {\n              duration: 2000,\n            });\n            this.inputStatus = '新留言';\n            this.inputShow = !this.inputShow;\n          });\n      } else {\n        this.$toasted.error('請 選取分數 與 留下評論 再送出', {\n          duration: 2000,\n        });\n      }\n    },\n    init() {\n      if (this.currentUser) {\n        // 確認使用者是否留過言\n        const checkArr = this.comments.find(\n          (comment) => comment.user.userId === this.currentUser.profile.userId,\n        );\n        // 若留過言\n        if (checkArr) {\n          // 不主動顯示輸入框，並讀入可編輯內容\n          this.inputShow = false;\n          this.comment = { ...checkArr };\n        }\n      }\n    },\n  },\n  created() {\n    window.setTimeout(this.init, 3000);\n  },\n};\n",{"version":3,"sources":["Comments.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmLA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Comments.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"course-rating\">\n    <!-- 評分顯示 -->\n    <section class=\"course-rating\">\n      <div class=\"heading-tertiary--dark mb-sm\">課程評分</div>\n      <div class=\"course-rating__box\">\n        <div class=\"course-rating__avg-rating\">\n          <div class=\"course-rating__rating-figure\">{{avgRating}}</div>\n          <div class=\"course-rating__user\">\n            <i class=\"fas fa-user\"></i>\n            <div>{{comments.length}}位學員評分</div>\n          </div>\n        </div>\n        <!-- bar -->\n        <div class=\"course-rating__rating-bars\">\n          <div class=\"course-rating__rating-bar\" v-for=\"(percent,i) in ratingPercents\" :key=\"i\">\n            <div class=\"course-rating__bar\">\n              <span class=\"course-rating__bar-progress\" :style=\"{width:percent+'%'}\"></span>\n            </div>\n            <div class=\"d-flex\" style=\"width:220px\">\n              <star-rating\n                :star-size=\"16\"\n                :read-only=\"true\"\n                :rounded-corners=\"true\"\n                :rating=\"(5-i)\"\n                :show-rating=\"false\"\n              ></star-rating>\n              <div class=\"course-rating__bar-num\">{{percent}} %</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <!-- 輸入評分區 -->\n    <section>\n      <div class=\"heading-tertiary--dark mb-sm\">評論</div>\n      <div class=\"user-comment\" v-if=\"inputShow\">\n        <div class=\"user-comment__img-box\">\n          <img class=\"user-comment__img\" :src=\"currentUser.profile.userImg\" v-if=\"currentUser\" />\n          <img\n            class=\"user-comment__img\"\n            src=\"https://png2.pngtree.com/svg/20161215/9bc7bae28b.png\"\n            v-else\n          />\n        </div>\n        <div class=\"user-comment__content\">\n          <div class=\"user-comment__info\">\n            <div v-if=\"currentUser\">\n              <i class=\"fas fa-user\"></i>\n              {{currentUser.profile.name}}\n            </div>\n            <star-rating\n              class=\"user-comment__rating\"\n              v-model=\"comment.rating\"\n              :star-size=\"20\"\n              :rounded-corners=\"true\"\n              :show-rating=\"false\"\n              :read-only=\"!currentUser\"\n            ></star-rating>\n          </div>\n          <!-- 輸入欄 -->\n          <form>\n            <div class=\"form__row\">\n              <div class=\"form__group\" style=\"margin-right:0px\">\n                <textarea\n                  class=\"user-comment__textarea\"\n                  v-model=\"comment.comment\"\n                  :readonly=\"!currentUser\"\n                  placeholder=\"請開始你的表演\"\n                  @click.prevent=\"alertLogReg\"\n                ></textarea>\n              </div>\n            </div>\n\n            <div class=\"form__group\">\n              <!-- 按鈕組 -->\n              <div class=\"btn-footer\" v-if=\"currentUser\">\n                <button\n                  class=\"btn btn-primary\"\n                  style=\"width:100px\"\n                  v-if=\"inputStatus==='新留言'\"\n                  @click.prevent=\"addComment\"\n                >送出</button>\n                <button\n                  class=\"btn btn-primary\"\n                  style=\"width:100px\"\n                  v-if=\"inputStatus==='編輯留言'\"\n                  @click.prevent=\"updateComment\"\n                >確認</button>\n                <button\n                  class=\"btn btn-primary--cancel\"\n                  style=\"width:100px\"\n                  v-if=\"inputStatus==='編輯留言'\"\n                  @click.prevent=\"inputStatus = '新留言';\n                  inputShow = !inputShow;comment.comment=tempComment\"\n                >取消</button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    </section>\n\n    <!-- 評論 -->\n    <section>\n      <div class=\"d-flex-column\">\n        <div\n          class=\"user-comment\"\n          v-for=\"comment in comments\"\n          :class=\"{'user-first':!!currentUser&&comment.user.userId=== currentUser.profile.userId,\n          'd-none':inputStatus!=='新留言'&&comment.user.userId===currentUser.profile.userId\n          }\"\n          :key=\"comment.user.userId\"\n        >\n          <div class=\"d-flex\">\n            <div class=\"user-comment__img-box\">\n              <img class=\"user-comment__img\" :src=\"comment.user.userImg\" />\n            </div>\n            <!-- 手機排版 -->\n            <div class=\"user-comment__info d-block-phone\">\n              <div class=\"d-flex\">\n                <div style=\"margin-right:10px\">\n                  <i class=\"fas fa-user\"></i>\n                  {{comment.user.name}}\n                </div>\n                <star-rating\n                  :rating=\"comment.rating\"\n                  :star-size=\"18\"\n                  :read-only=\"true\"\n                  :rounded-corners=\"true\"\n                  :show-rating=\"false\"\n                ></star-rating>\n              </div>\n              <div>\n                <i class=\"far fa-clock\"></i>\n                {{time(comment.timestamp)}}\n              </div>\n            </div>\n          </div>\n          <div\n            class=\"user-comment__content\"\n            :class=\"{'user-current':!!currentUser&&comment.user.userId\n            === currentUser.profile.userId}\"\n          >\n            <!-- 桌機排版 -->\n            <div class=\"user-comment__info d-none-phone\">\n              <div>\n                <i class=\"fas fa-user\"></i>\n                {{comment.user.name}}\n                <i class=\"far fa-clock\"></i>\n                {{time(comment.timestamp)}}\n              </div>\n\n              <star-rating\n                :rating=\"comment.rating\"\n                :star-size=\"20\"\n                :read-only=\"true\"\n                :rounded-corners=\"true\"\n                :show-rating=\"false\"\n              ></star-rating>\n            </div>\n            <p>{{comment.comment}}</p>\n            <div class=\"btn-footer\">\n              <button\n                class=\"btn btn-primary\"\n                style=\"width:100px\"\n                v-if=\"!!currentUser&&comment.user.userId=== currentUser.profile.userId\"\n                @click=\"inputShow =!inputShow;inputStatus='編輯留言';tempComment=comment.comment\"\n              >修改</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  </div>\n</template>\n\n<script>\nimport StarRating from 'vue-star-rating';\nimport moment from 'moment';\n\nexport default {\n  name: 'Comments',\n  components: {\n    StarRating,\n  },\n  props: ['comments', 'currentUser', 'courseId'],\n  data() {\n    return {\n      comment: {\n        comment: null,\n        rating: null,\n      },\n      inputStatus: '新留言',\n      inputShow: true,\n      tempComment: null,\n    };\n  },\n  computed: {\n    // 計算平均分數\n    avgRating() {\n      if (this.comments.length === 0) {\n        return 0;\n      }\n      const avg = this.comments\n        .map((comment) => comment.rating)\n        .reduce((acc, cur) => acc + cur) / this.comments.length;\n      return parseFloat(avg.toFixed(1));\n    },\n    // 計算每個bar\n    ratingPercents() {\n      let percents = [0, 0, 0, 0, 0];\n      if (this.comments.length === 0) {\n        return percents;\n      }\n      const ratings = this.comments.map((item) => item.rating); // [5,3,3]\n      // 計算每個rating出現比率\n      percents = percents.map(\n        (item, index) => (item = ratings.filter((rating) => rating === index + 1).length)\n          / ratings.length,\n      );\n      // 換算百分比\n      return percents.map((num) => parseFloat(num.toFixed(2)) * 100).reverse();\n    },\n  },\n  watch: {\n    // 若平均評價改變則更新資料庫資料\n    avgRating() {\n      const course = { ...this.$store.state.courses.course };\n      course.avgRating = this.avgRating;\n      this.$store.dispatch('courses/updateCourse', {\n        id: this.courseId,\n        course,\n      });\n    },\n  },\n  methods: {\n    time(num) {\n      return moment(num).format('YYYY/MM/DD HH:mm');\n    },\n    alertLogReg() {\n      if (!this.currentUser) {\n        this.$toasted.info('請先 註冊/登入 以進行評價', {\n          duration: 2000,\n        });\n      }\n    },\n\n    // 新增評價\n    addComment() {\n      if (this.comment.rating && this.comment.comment) {\n        this.comment.user = this.currentUser.profile.userId;\n        this.comment.toId = this.courseId;\n        this.$store\n          .dispatch('comments/createComment', {\n            comment: this.comment,\n            user: this.currentUser,\n          })\n          .then(() => {\n            this.$toasted.success('已收到您的評價', {\n              duration: 2000,\n            });\n            this.inputStatus = '新留言';\n            this.inputShow = !this.inputShow;\n          });\n      } else {\n        this.$toasted.error('請 選取分數 與 留下評論 再送出', {\n          duration: 2000,\n        });\n      }\n    },\n\n    updateComment() {\n      if (this.comment.rating && this.comment.comment) {\n        this.$store\n          .dispatch('comments/updateComment', this.comment)\n          .then(() => {\n            this.$toasted.success('成功修改評價', {\n              duration: 2000,\n            });\n            this.inputStatus = '新留言';\n            this.inputShow = !this.inputShow;\n          });\n      } else {\n        this.$toasted.error('請 選取分數 與 留下評論 再送出', {\n          duration: 2000,\n        });\n      }\n    },\n    init() {\n      if (this.currentUser) {\n        // 確認使用者是否留過言\n        const checkArr = this.comments.find(\n          (comment) => comment.user.userId === this.currentUser.profile.userId,\n        );\n        // 若留過言\n        if (checkArr) {\n          // 不主動顯示輸入框，並讀入可編輯內容\n          this.inputShow = false;\n          this.comment = { ...checkArr };\n        }\n      }\n    },\n  },\n  created() {\n    window.setTimeout(this.init, 3000);\n  },\n};\n</script>\n"]}]}