{"remainingRequest":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/Front-Gym/src/views/backend/Profile.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/Front-Gym/src/views/backend/Profile.vue","mtime":1584522369633},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { required, url } from \"vuelidate/lib/validators\";\nimport moment from \"moment\";\n\nexport default {\n  name: \"Profile\",\n  data() {\n    return {\n      showDetail: false,\n      account: null,\n      updatePhoto: false\n    };\n  },\n  validations: {\n    account: {\n      name: { required },\n      userImg: { required, url }\n    }\n  },\n  computed: {\n    isLoading() {\n      return this.$store.state.isLoading;\n    },\n    user() {\n      return this.$store.state.auth.user.profile;\n    },\n    payments() {\n      return this.$store.state.checkout.payments.filter(\n        payment => payment.user.userId === this.user.userId\n      );\n    },\n    getDownloadURL() {\n      return this.$store.state.downloadURL;\n    }\n  },\n  watch: {\n    getDownloadURL() {\n      if (this.getDownloadURL) {\n        this.account.userImg = this.getDownloadURL;\n        this.updatePhoto = false;\n      }\n    }\n  },\n  methods: {\n    time(num) {\n      return moment(num).format(\"YYYY/MM/DD HH:mm\");\n    },\n\n    //上傳圖片\n    uploadImage(e) {\n      let file = e.target.files[0];\n      if (!file.type.includes(\"image\")) {\n        this.$toasted.error(\"請上傳圖片檔案\", { duration: 3000 });\n      } else {\n        this.updatePhoto = true;\n        this.$store.dispatch(\"updateFile\", { file: file, place: \"profile/\" });\n      }\n    },\n\n    //更新個人檔案\n    updateUser() {\n      this.$v.$touch();\n      if (!this.updatePhoto) {\n        if (this.$v.$invalid) {\n          this.$toasted.error(\"請正確填寫必要資訊\", { duration: 3000 });\n        } else {\n          debugger;\n          this.$store\n            .dispatch(\"auth/updateUser\", {\n              id: this.user.userId,\n              user: this.account\n            })\n            .then(() => {\n              this.$toasted.success(\"更新成功!!\", {\n                duration: 2000\n              });\n            });\n        }\n      }\n    },\n\n    //show accordion\n    show(i) {\n      this.showDetail = this.showDetail === i ? false : i;\n    },\n\n    //前往結帳\n    goCheckout(id) {\n      this.$router.push(`/checkout/${id}`);\n    }\n  },\n  created() {\n    this.$store.commit(\"setDownloadUrl\", null);\n    this.$store.dispatch(\"checkout/getPayments\");\n    this.account = { ...this.user };\n  }\n};\n",{"version":3,"sources":["Profile.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiMA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Profile.vue","sourceRoot":"src/views/backend","sourcesContent":["<template>\n  <div>\n    <loading :active.sync=\"isLoading\" :opacity=\".8\" :background-color=\"'#000'\" :color=\"'#ff5722'\"></loading>\n\n    <h2 class=\"heading-secondary\">個人資訊</h2>\n    <div class=\"admin-panel mb-md\">\n      <div class=\"heading-tertiary--dark mb-sm\">\n        <i class=\"fas fa-cog\"></i>帳號設定\n      </div>\n      <p class=\"mb-sm\">\n        請確認姓名、電子郵件、圖片是否已設定好，如已設定完成，務必確認上述資訊為最新資訊。\n        （\n        <span class=\"text-highlight\">*</span> 為必填欄位）\n      </p>\n      <div class=\"profile-admin__form\">\n        <div class=\"profile-admin__img\">\n          <div class=\"form__group\">\n            <label class=\"form__label\">\n              個人檔案圖片\n              <span class=\"text-highlight\">*</span>\n            </label>\n            <img v-if=\"account.userImg\" class :src=\"account.userImg\" alt>\n            <img v-if=\"!account.userImg\" src=\"https://png2.pngtree.com/svg/20161215/9bc7bae28b.png\">\n          </div>\n        </div>\n        <!-- 個人檔案編輯 -->\n        <div class=\"profile-admin__info\">\n          <div class=\"form__row\">\n            <div class=\"form__group\">\n              <label class=\"form__label\">\n                姓名\n                <span class=\"text-highlight\">*</span>\n              </label>\n              <input class=\"form__input\" placeholder=\"請填入姓名\" v-model=\"account.name\">\n              <template v-if=\"$v.account.name.$dirty\">\n                <span v-if=\"!$v.account.name.required\" class=\"text-warning\">姓名為必填欄位</span>\n              </template>\n            </div>\n            <div class=\"form__group\">\n              <label class=\"form__label\">\n                電子信箱（不可變更）\n                <span class=\"text-highlight\">*</span>\n              </label>\n              <input class=\"form__input\" v-model=\"account.email\" disabled>\n            </div>\n          </div>\n          <div class=\"form__row\">\n            <div class=\"form__group\">\n              <label class=\"form__label\" for>輸入圖片網址</label>\n              <input\n                class=\"form__input\"\n                placeholder=\"https://unsplash...\"\n                type=\"text\"\n                v-model=\"account.userImg\"\n              >\n              <template v-if=\"$v.account.userImg.$dirty\">\n                <span v-if=\"!$v.account.userImg.required\" class=\"text-warning\">圖片網址為必填欄位</span>\n                <span v-if=\"!$v.account.userImg.url\" class=\"text-warning\">請輸入正確格式網址</span>\n              </template>\n            </div>\n            <div class=\"form__group\">\n              <label class=\"form__label\">\n                或 選擇封面檔案\n                <i class=\"fas fa-spinner fa-spin\" v-if=\"updatePhoto\"></i>\n              </label>\n              <input class=\"form__input\" type=\"file\" @change=\"uploadImage\">\n            </div>\n          </div>\n          <div class=\"btn-footer\">\n            <button style=\"width:120px\" class=\"btn btn-primary\" @click=\"updateUser\">修改</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 訂單 -->\n    <div class=\"admin-panel mb-md\">\n      <div class=\"heading-tertiary--dark mb-sm\">\n        <i class=\"fas fa-file-invoice-dollar\"></i> 訂單紀錄\n      </div>\n      <p class=\"mb-md\">商品進入購物車並填寫完購買資訊以後，該筆訂單即成立，這裡您可以查看所有訂單詳細資訊，掌握每一筆交易狀況。</p>\n\n      <div v-if=\"payments.length===0\" class=\"heading-tertiary--grey\">尚無訂單：）</div>\n\n      <div v-else v-for=\"(payment,i) in payments\" :key=\"payment.id\" class=\"mb-md\">\n        <div class=\"go-checkout d-flex\">\n          <p class=\"heading-tertiary--grey mb-sm\">訂單編號：{{payment.id}}</p>\n          <button\n            v-if=\"payment.status==='尚未付款'\"\n            @click.prevent=\"goCheckout(payment.id)\"\n            class=\"btn btn-primary mb-sm\"\n            style=\"width:120px\"\n          >確認付款</button>\n        </div>\n\n        <div class=\"admin-order\" :class=\"{'admin-order--notpay':payment.status==='尚未付款'}\">\n          <div class=\"d-flex admin-order-info\">\n            <div style=\"margin-right:3rem\">\n              <p>訂單成立： {{time(payment.createdAt)}}</p>\n              <p>\n                付款時間：\n                <template v-if=\"payment.status==='付款完成'\">{{time(payment.finishedAt)}}</template>\n                <template v-else>\n                  <i class=\"fas fa-exclamation-triangle\" style=\"color:#ff5721;margin-right:5px\"></i>尚未付款\n                </template>\n              </p>\n            </div>\n            <div>\n              <p>實付金額：{{payment.total.totalPrice|currency}}</p>\n              <p>付款方式：{{payment.user.payWay}}</p>\n            </div>\n          </div>\n          <button class=\"btn detail-show-btn mt-sm\" @click=\"show(i)\">\n            <template v-if=\"showDetail===i\">\n              <i class=\"fas fa-chevron-up\"></i> 收合內容\n            </template>\n            <template v-else>\n              <i class=\"fas fa-chevron-down\"></i> 查看詳細\n            </template>\n          </button>\n          <!-- 購買明細 -->\n          <transition name=\"fade\">\n            <div class=\"d-none-phone\" v-if=\"showDetail===i\">\n              <p>價格明細：</p>\n              <table class=\"checkout-table\">\n                <thead>\n                  <tr>\n                    <th>課程名稱</th>\n                    <th>購買方案</th>\n                    <th>原價</th>\n                    <th>售價</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"course in payment.courses\" :key=\"course.title\">\n                    <td>{{course.title}}</td>\n                    <td>{{course.plan}}</td>\n                    <td style=\"text-align:right\">{{course.price|currency}}</td>\n                    <td style=\"text-align:right\">{{course.sellingPrice|currency}}</td>\n                  </tr>\n                </tbody>\n              </table>\n              <div class=\"checkout-payment__total\">\n                實付金額：\n                <b class=\"ml-sm\">{{payment.total.totalPrice|currency}}</b>\n              </div>\n            </div>\n          </transition>\n          <!-- 購買明細mobile -->\n          <transition name=\"fade\">\n            <div class=\"d-block-phone\" v-if=\"showDetail===i\">\n              <p>價格明細：</p>\n              <table class=\"checkout-table\" v-for=\"course in payment.courses\" :key=\"course.title\">\n                <tbody>\n                  <tr>\n                    <td>\n                      <b>課程名稱</b>\n                    </td>\n                    <td>{{course.title}}</td>\n                  </tr>\n                  <tr>\n                    <td>\n                      <b>購買方案</b>\n                    </td>\n                    <td>{{course.plan}}</td>\n                  </tr>\n                  <tr>\n                    <td>\n                      <b>原價</b>\n                    </td>\n                    <td>{{course.price|currency}}</td>\n                  </tr>\n                  <tr>\n                    <td>\n                      <b>售價</b>\n                    </td>\n                    <td>{{course.sellingPrice|currency}}</td>\n                  </tr>\n                </tbody>\n              </table>\n              <div class=\"checkout-payment__total\">\n                實付金額：\n                <b class=\"ml-sm\">{{payment.total.totalPrice|currency}}</b>\n              </div>\n            </div>\n          </transition>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { required, url } from \"vuelidate/lib/validators\";\nimport moment from \"moment\";\n\nexport default {\n  name: \"Profile\",\n  data() {\n    return {\n      showDetail: false,\n      account: null,\n      updatePhoto: false\n    };\n  },\n  validations: {\n    account: {\n      name: { required },\n      userImg: { required, url }\n    }\n  },\n  computed: {\n    isLoading() {\n      return this.$store.state.isLoading;\n    },\n    user() {\n      return this.$store.state.auth.user.profile;\n    },\n    payments() {\n      return this.$store.state.checkout.payments.filter(\n        payment => payment.user.userId === this.user.userId\n      );\n    },\n    getDownloadURL() {\n      return this.$store.state.downloadURL;\n    }\n  },\n  watch: {\n    getDownloadURL() {\n      if (this.getDownloadURL) {\n        this.account.userImg = this.getDownloadURL;\n        this.updatePhoto = false;\n      }\n    }\n  },\n  methods: {\n    time(num) {\n      return moment(num).format(\"YYYY/MM/DD HH:mm\");\n    },\n\n    //上傳圖片\n    uploadImage(e) {\n      let file = e.target.files[0];\n      if (!file.type.includes(\"image\")) {\n        this.$toasted.error(\"請上傳圖片檔案\", { duration: 3000 });\n      } else {\n        this.updatePhoto = true;\n        this.$store.dispatch(\"updateFile\", { file: file, place: \"profile/\" });\n      }\n    },\n\n    //更新個人檔案\n    updateUser() {\n      this.$v.$touch();\n      if (!this.updatePhoto) {\n        if (this.$v.$invalid) {\n          this.$toasted.error(\"請正確填寫必要資訊\", { duration: 3000 });\n        } else {\n          debugger;\n          this.$store\n            .dispatch(\"auth/updateUser\", {\n              id: this.user.userId,\n              user: this.account\n            })\n            .then(() => {\n              this.$toasted.success(\"更新成功!!\", {\n                duration: 2000\n              });\n            });\n        }\n      }\n    },\n\n    //show accordion\n    show(i) {\n      this.showDetail = this.showDetail === i ? false : i;\n    },\n\n    //前往結帳\n    goCheckout(id) {\n      this.$router.push(`/checkout/${id}`);\n    }\n  },\n  created() {\n    this.$store.commit(\"setDownloadUrl\", null);\n    this.$store.dispatch(\"checkout/getPayments\");\n    this.account = { ...this.user };\n  }\n};\n</script>"]}]}