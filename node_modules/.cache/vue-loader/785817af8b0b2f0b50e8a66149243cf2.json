{"remainingRequest":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/Front-Gym/src/views/frontend/Checkout.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/Front-Gym/src/views/frontend/Checkout.vue","mtime":1584965848165},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport StepBar from '@/components/StepBar';\nimport { required, email, numeric } from 'vuelidate/lib/validators';\n\nexport default {\n  name: 'Checkout',\n  components: {\n    StepBar,\n  },\n  data() {\n    return {\n      status: 'checkout',\n      paymentId: null,\n      userInfo: {\n        payWay: null,\n        name: null,\n        email: null,\n        phone: null,\n        remark: null,\n      },\n    };\n  },\n  validations: {\n    userInfo: {\n      payWay: {\n        required,\n      },\n      name: {\n        required,\n      },\n      email: {\n        required,\n        email,\n      },\n      phone: {\n        required,\n        numeric,\n      },\n    },\n  },\n  computed: {\n    // user\n    user() {\n      return this.$store.state.auth.user;\n    },\n    // 價格相關\n    total() {\n      return this.$store.state.checkout.payment.total;\n    },\n    // 課程相關\n    courses() {\n      return this.$store.state.checkout.payment.courses;\n    },\n    // 訂單路徑\n    path() {\n      return this.$store.state.checkout.payment.id;\n    },\n  },\n  watch: {\n    path() {\n      this.$router.push(`/checkout/${this.path}`);\n    },\n  },\n  methods: {\n    // 結帳\n    checkOut() {\n      this.$v.$touch();\n      if (this.$v.$invalid) {\n        this.$toasted.error('請正確填寫必要資訊', { duration: 3000 });\n      } else {\n        // 購買課程資訊\n        const buyCourses = this.courses.map((course) => ({\n          id: course.id,\n          title: course.title,\n          plan:\n            // 如果這是優惠課程並且有輸入優惠碼\n            course.discount && this.total.totalDiscount > 0\n              ? '精選優惠'\n              : '課程售價',\n          price: course.price,\n          sellingPrice:\n            // 如果這是優惠課程並且有輸入優惠碼\n            course.discount && this.total.totalDiscount > 0\n              ? course.price - this.$store.state.cart.discount\n              : course.price,\n        }));\n\n        const payment = {\n          courses: buyCourses,\n          user: { userId: this.user.uid, ...this.userInfo },\n          total: this.total,\n        };\n\n        // 建立訂單\n        this.$store.dispatch('checkout/createPayment', payment).then(() => {\n          this.$toasted.success('訂單建立成功 請儘快付款', { duration: 3000 });\n          // 清空購物車與暫時訂單\n          this.$store.commit('cart/clearCart');\n        });\n      }\n    },\n  },\n  created() {\n    // 設定初始資料\n    this.userInfo.name = this.user.profile.name;\n    this.userInfo.email = this.user.profile.email;\n  },\n};\n",{"version":3,"sources":["Checkout.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8NA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Checkout.vue","sourceRoot":"src/views/frontend","sourcesContent":["<template>\n  <div>\n    <main class=\"courses-main\">\n      <div class=\"container\">\n        <step-bar :status=\"status\"></step-bar>\n\n        <div class=\"checkout\">\n          <div class=\"checkout__info mb-sm\">\n            <!-- 購買課程 -->\n            <div class=\"checkout-form checkout-payment__courses mb-sm\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"fas fa-money-check fa-lg\"></i> 結帳金額\n              </div>\n              <table class=\"checkout-table\">\n                <thead>\n                  <tr>\n                    <th>課程名稱</th>\n                    <th class=\"d-none-phone\">購買方案</th>\n                    <th class=\"d-none-phone\">原價</th>\n                    <th>售價</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"course in courses\" :key=\"course.title\">\n                    <td>{{ course.title }}</td>\n                    <td class=\"d-none-phone\">\n                      <template\n                        v-if=\"course.discount && total.totalDiscount > 0\"\n                        >精選優惠</template\n                      >\n                      <template v-else>課程售價</template>\n                    </td>\n                    <td class=\"d-none-phone\" style=\"text-align:right\">\n                      {{ course.price | currency }}\n                    </td>\n\n                    <td style=\"text-align:right\">\n                      <template\n                        v-if=\"total.totalDiscount !== 0 && course.discount\"\n                        >{{ (course.price - 100) | currency }}</template\n                      >\n                      <template v-else>{{ course.price | currency }}</template>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n              <div class=\"checkout-payment__total\">\n                實付金額\n                <b class=\"ml-sm\">{{ total.totalPrice | currency }}</b>\n              </div>\n            </div>\n\n            <!-- 購買資訊-付款方式 -->\n            <div class=\"checkout-form mb-sm\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"far fa-credit-card fa-lg\"></i>\n                付款方式\n              </div>\n\n              <div class=\"form__row\">\n                <div class=\"form__group\">\n                  <select\n                    class=\"form__input\"\n                    v-model=\"userInfo.payWay\"\n                    :class=\"{\n                      'form__input--warning': $v.userInfo.payWay.$error,\n                    }\"\n                  >\n                    <option :value=\"null\" disabled>--請選擇付款方式--</option>\n                    <option value=\"信用卡\">信用卡</option>\n                    <option value=\"ATM轉帳\">ATM轉帳</option>\n                    <option value=\"超商付款\">超商付款</option>\n                  </select>\n                  <template v-if=\"$v.userInfo.payWay.$dirty\">\n                    <span\n                      class=\"text-warning\"\n                      v-if=\"!$v.userInfo.payWay.required\"\n                      >請選擇付款方式</span\n                    >\n                  </template>\n                </div>\n              </div>\n            </div>\n\n            <!-- 購買資訊-買家資訊 -->\n            <div class=\"checkout-form\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"fas fa-cash-register fa-lg\"></i>\n                發票選項\n              </div>\n              <p class=\"checkout-form__text mb-sm\">\n                以下資訊只用於開立發票，不會在其他頁面顯示。發票開立後不可更改，請確認資訊是否都填寫正確！\n                <br />（ <span class=\"text-highlight\">*</span> 為必填欄位）\n              </p>\n\n              <form class=\"checkout-form__form\">\n                <div class=\"form__row\">\n                  <div class=\"form__group\">\n                    <label class=\"form__label\">\n                      姓名\n                      <span class=\"text-highlight\">*</span>\n                    </label>\n\n                    <input\n                      class=\"form__input\"\n                      v-model.trim=\"userInfo.name\"\n                      placeholder=\"請填入真實姓名\"\n                      type=\"text\"\n                      :class=\"{\n                        'form__input--warning': $v.userInfo.name.$error,\n                      }\"\n                    />\n                    <template v-if=\"$v.userInfo.name.$dirty\">\n                      <span\n                        class=\"text-warning\"\n                        v-if=\"!$v.userInfo.name.required\"\n                        >姓名為必填欄位</span\n                      >\n                    </template>\n                  </div>\n                  <div class=\"form__group\">\n                    <label class=\"form__label\">\n                      聯絡電子信箱\n                      <span class=\"text-highlight\">*</span>\n                    </label>\n                    <input\n                      class=\"form__input\"\n                      v-model.trim=\"userInfo.email\"\n                      placeholder=\"請填入電子信箱\"\n                      type=\"email\"\n                      :class=\"{\n                        'form__input--warning': $v.userInfo.email.$error,\n                      }\"\n                    />\n                    <template v-if=\"$v.userInfo.email.$dirty\">\n                      <span\n                        class=\"text-warning\"\n                        v-if=\"!$v.userInfo.email.required\"\n                        >信箱為必填欄位</span\n                      >\n                      <span class=\"text-warning\" v-if=\"!$v.userInfo.email.email\"\n                        >請輸入正確信箱格式</span\n                      >\n                    </template>\n                  </div>\n                </div>\n                <div class=\"form__row\">\n                  <div class=\"form__group\">\n                    <label class=\"form__label\">\n                      聯絡電話\n                      <span class=\"text-highlight\">*</span>\n                    </label>\n                    <input\n                      class=\"form__input\"\n                      v-model.trim.number=\"userInfo.phone\"\n                      placeholder=\"請填入聯絡電話\"\n                      type=\"tel\"\n                      :class=\"{\n                        'form__input--warning': $v.userInfo.phone.$error,\n                      }\"\n                    />\n                    <template v-if=\"$v.userInfo.phone.$dirty\">\n                      <span\n                        class=\"text-warning\"\n                        v-if=\"!$v.userInfo.phone.required\"\n                        >電話為必填欄位</span\n                      >\n                      <span\n                        class=\"text-warning\"\n                        v-if=\"!$v.userInfo.phone.numeric\"\n                        >電話號碼必為數字</span\n                      >\n                    </template>\n                  </div>\n                </div>\n                <div class=\"form__row\">\n                  <div class=\"form__group\">\n                    <label class=\"form__label\">備註</label>\n\n                    <textarea\n                      class=\"form__input\"\n                      v-model=\"userInfo.remark\"\n                      placeholder=\"如有任何備註事項請註明\"\n                      cols=\"30\"\n                      rows=\"20\"\n                      style=\"height:100px\"\n                    ></textarea>\n                  </div>\n                </div>\n              </form>\n            </div>\n          </div>\n\n          <!-- 付款確認 -->\n          <div class=\"checkout__summary\">\n            <div class=\"checkout__summary-title heading-tertiary--dark\">\n              訂單明細\n            </div>\n\n            <div class=\"checkout__summary-price\">\n              <div>原價</div>\n              <div>{{ total.totalOrigin | currency }}</div>\n            </div>\n            <div class=\"checkout__summary-price\">\n              <div>優惠券折扣</div>\n              <div>-{{ total.totalDiscount | currency }}</div>\n            </div>\n            <div class=\"checkout__summary-total\">\n              <div>總計</div>\n              <h3>{{ total.totalPrice | currency }}</h3>\n            </div>\n            <button class=\"btn btn-primary\" @click.prevent=\"checkOut()\">\n              確認送出\n            </button>\n          </div>\n        </div>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script>\nimport StepBar from '@/components/StepBar';\nimport { required, email, numeric } from 'vuelidate/lib/validators';\n\nexport default {\n  name: 'Checkout',\n  components: {\n    StepBar,\n  },\n  data() {\n    return {\n      status: 'checkout',\n      paymentId: null,\n      userInfo: {\n        payWay: null,\n        name: null,\n        email: null,\n        phone: null,\n        remark: null,\n      },\n    };\n  },\n  validations: {\n    userInfo: {\n      payWay: {\n        required,\n      },\n      name: {\n        required,\n      },\n      email: {\n        required,\n        email,\n      },\n      phone: {\n        required,\n        numeric,\n      },\n    },\n  },\n  computed: {\n    // user\n    user() {\n      return this.$store.state.auth.user;\n    },\n    // 價格相關\n    total() {\n      return this.$store.state.checkout.payment.total;\n    },\n    // 課程相關\n    courses() {\n      return this.$store.state.checkout.payment.courses;\n    },\n    // 訂單路徑\n    path() {\n      return this.$store.state.checkout.payment.id;\n    },\n  },\n  watch: {\n    path() {\n      this.$router.push(`/checkout/${this.path}`);\n    },\n  },\n  methods: {\n    // 結帳\n    checkOut() {\n      this.$v.$touch();\n      if (this.$v.$invalid) {\n        this.$toasted.error('請正確填寫必要資訊', { duration: 3000 });\n      } else {\n        // 購買課程資訊\n        const buyCourses = this.courses.map((course) => ({\n          id: course.id,\n          title: course.title,\n          plan:\n            // 如果這是優惠課程並且有輸入優惠碼\n            course.discount && this.total.totalDiscount > 0\n              ? '精選優惠'\n              : '課程售價',\n          price: course.price,\n          sellingPrice:\n            // 如果這是優惠課程並且有輸入優惠碼\n            course.discount && this.total.totalDiscount > 0\n              ? course.price - this.$store.state.cart.discount\n              : course.price,\n        }));\n\n        const payment = {\n          courses: buyCourses,\n          user: { userId: this.user.uid, ...this.userInfo },\n          total: this.total,\n        };\n\n        // 建立訂單\n        this.$store.dispatch('checkout/createPayment', payment).then(() => {\n          this.$toasted.success('訂單建立成功 請儘快付款', { duration: 3000 });\n          // 清空購物車與暫時訂單\n          this.$store.commit('cart/clearCart');\n        });\n      }\n    },\n  },\n  created() {\n    // 設定初始資料\n    this.userInfo.name = this.user.profile.name;\n    this.userInfo.email = this.user.profile.email;\n  },\n};\n</script>\n"]}]}