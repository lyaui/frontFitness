{"remainingRequest":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/Front-Gym/src/views/CheckoutInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/Front-Gym/src/views/CheckoutInfo.vue","mtime":1583422475934},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/Front-Gym/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport StepBar from \"@/components/StepBar\";\nimport moment from \"moment\";\nimport JsBarcode from \"jsbarcode\";\n\nexport default {\n  components: {\n    StepBar\n  },\n  data() {\n    return {\n      status: \"checkout\",\n      paymentId: null\n    };\n  },\n  computed: {\n    isLoading() {\n      return this.$store.state.isLoading;\n    },\n    payment() {\n      return this.$store.state.checkout.payment;\n    },\n    //user\n    user() {\n      return this.$store.state.checkout.payment.user;\n    },\n    //價格相關\n    total() {\n      return this.$store.state.checkout.payment.total;\n    },\n    //課程相關\n    courses() {\n      return this.$store.state.checkout.payment.courses;\n    },\n    //訂單路徑\n    path() {\n      return this.$store.state.checkout.payment.id;\n    }\n  },\n\n  methods: {\n    barCode() {\n      window.setTimeout(\n        () =>\n          JsBarcode(\"#barcode\", \"frontFitness\", {\n            format: \"CODE39\",\n            lineColor: \"#707070\",\n            font: \"Russo+One\",\n            fontSize: 15,\n            width: 1.1,\n            height: 40,\n            displayValue: true\n          }),\n        1000\n      );\n    },\n    checkOut(id) {\n      //課程都沒有額滿的情況，更新課程數量\n      // this.payment.courses.forEach(course => {\n      //   db.collection(\"courses\")\n      //     .doc(course.id)\n      //     .update({\n      //       remainQuantity: course.remainQuantity - 1\n      //     })\n      //     .then()\n      //     .catch();\n      // });\n\n      // 更改訂單付款狀態\n      this.$store.dispatch(\"checkout/finishPayment\", id).then(_ => {\n        // 結帳成功提示\n        this.$toasted.success(`付款成功，感謝購買！`, {\n          duration: 2000\n        });\n        //發票條碼\n        this.barCode()\n      });\n    }\n  },\n  created() {\n    this.paymentId = this.$route.params.paymentId;\n    this.$store.dispatch(\"checkout/getPaymentById\", this.paymentId);\n  }\n};\n",{"version":3,"sources":["CheckoutInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CheckoutInfo.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <loading :active.sync=\"isLoading\" :opacity=\".8\" :background-color=\"'#000'\" :color=\"'#ff5722'\"></loading>\n\n    <main class=\"courses-main\">\n      <div class=\"container\">\n        <step-bar :status=\"status\"></step-bar>\n\n        <div class=\"checkout\">\n          <div class=\"checkout__info mb-sm\">\n            <!-- 購買課程 -->\n            <div class=\"checkout-form checkout-payment__courses mb-sm\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"fas fa-money-check fa-lg\"></i> 結帳金額\n              </div>\n              <table class=\"checkout-table\">\n                <thead>\n                  <tr>\n                    <th>課程名稱</th>\n                    <th>購買方案</th>\n                    <th>原價</th>\n                    <th>售價</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"course in payment.courses\" :key=\"course.title\">\n                    <td>{{course.title}}</td>\n                    <td>\n                      <template v-if=\"course.discount\">精選優惠</template>\n                      <template v-else>課程售價</template>\n                    </td>\n                    <td style=\"text-align:right\">{{course.price|currency}}</td>\n\n                    <td style=\"text-align:right\">{{course.sellingPrice|currency}}</td>\n                  </tr>\n                </tbody>\n              </table>\n              <div class=\"checkout-payment__total\">\n                實付金額\n                <b class=\"ml-sm\">{{total.totalPrice|currency}}</b>\n              </div>\n            </div>\n            <!-- 付款資訊 -->\n            <div class=\"checkout-form checkout-payment__user\">\n              <div class=\"heading-tertiary--dark mb-sm\">\n                <i class=\"far fa-address-card fa-lg\"></i> 付款資訊\n              </div>\n              <div class=\"checkout-payment__invoice\">\n                <div>\n                  <b>付款方式</b>\n                  <p>{{user.payWay}}</p>\n                </div>\n                <div>\n                  <b>發票資訊</b>\n                  <p>聯絡人：{{user.name}}</p>\n                  <p>聯絡電子信箱：{{user.email}}</p>\n                  <p>聯絡電話：{{user.phone}}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n          <!-- 付款狀態 -->\n          <div class=\"checkout__summary\" v-if=\"payment.status==='尚未付款'\">\n            <div class=\"checkout__summary-title heading-tertiary--dark\">訂單明細</div>\n\n            <div class=\"checkout__summary-price\">\n              <div>原價</div>\n              <div>{{total.totalOrigin|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-price\" v-if=\"total.totalDiscount>0\">\n              <div>優惠券折扣</div>\n              <div>-{{total.totalDiscount|currency}}</div>\n            </div>\n            <div class=\"checkout__summary-total\">\n              <div>總計</div>\n              <h3>{{total.totalPrice|currency}}</h3>\n            </div>\n            <button\n              class=\"btn btn-primary\"\n              style=\"display: inline-block; background-color: rgb(255, 87, 33); border-left-color: rgb(255, 87, 33); border-right-color: rgb(255, 87, 33);\"\n              @click.prevent=\"checkOut(payment.id)\"\n            >確認付款</button>\n          </div>\n          <div class=\"checkout__summary\" v-if=\"payment.status==='付款完成'\">\n            <div class=\"mb-sm heading-tertiary--dark\">付款成功 感謝購買</div>\n\n            <img class=\"mb-sm mt-sm\" width=\"60%\" src=\"@/assets/img/checked.svg\">\n            <ul class=\"checkout__summary-list\">\n              <li class=\"checkout__summary-item\">訂單編號：{{payment.id}}</li>\n              <li class=\"checkout__summary-item\">購買日期：{{payment.createdAt}}</li>\n              <li class=\"checkout__summary-item\">付款金額：{{total.totalPrice|currency}}</li>\n            </ul>\n            <svg id=\"barcode\" class=\"mt-sm\"></svg>\n          </div>\n        </div>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script>\nimport StepBar from \"@/components/StepBar\";\nimport moment from \"moment\";\nimport JsBarcode from \"jsbarcode\";\n\nexport default {\n  components: {\n    StepBar\n  },\n  data() {\n    return {\n      status: \"checkout\",\n      paymentId: null\n    };\n  },\n  computed: {\n    isLoading() {\n      return this.$store.state.isLoading;\n    },\n    payment() {\n      return this.$store.state.checkout.payment;\n    },\n    //user\n    user() {\n      return this.$store.state.checkout.payment.user;\n    },\n    //價格相關\n    total() {\n      return this.$store.state.checkout.payment.total;\n    },\n    //課程相關\n    courses() {\n      return this.$store.state.checkout.payment.courses;\n    },\n    //訂單路徑\n    path() {\n      return this.$store.state.checkout.payment.id;\n    }\n  },\n\n  methods: {\n    barCode() {\n      window.setTimeout(\n        () =>\n          JsBarcode(\"#barcode\", \"frontFitness\", {\n            format: \"CODE39\",\n            lineColor: \"#707070\",\n            font: \"Russo+One\",\n            fontSize: 15,\n            width: 1.1,\n            height: 40,\n            displayValue: true\n          }),\n        1000\n      );\n    },\n    checkOut(id) {\n      //課程都沒有額滿的情況，更新課程數量\n      // this.payment.courses.forEach(course => {\n      //   db.collection(\"courses\")\n      //     .doc(course.id)\n      //     .update({\n      //       remainQuantity: course.remainQuantity - 1\n      //     })\n      //     .then()\n      //     .catch();\n      // });\n\n      // 更改訂單付款狀態\n      this.$store.dispatch(\"checkout/finishPayment\", id).then(_ => {\n        // 結帳成功提示\n        this.$toasted.success(`付款成功，感謝購買！`, {\n          duration: 2000\n        });\n        //發票條碼\n        this.barCode()\n      });\n    }\n  },\n  created() {\n    this.paymentId = this.$route.params.paymentId;\n    this.$store.dispatch(\"checkout/getPaymentById\", this.paymentId);\n  }\n};\n</script>"]}]}