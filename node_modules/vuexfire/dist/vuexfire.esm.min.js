/*!
  * vuexfire v3.2.1
  * (c) 2019 Eduardo San Martin Morote
  * @license MIT
  */
/*!
  * vuexfire v3.2.1
  * (c) 2019 Eduardo San Martin Morote
  * @license MIT
  */
var e="vuexfire/SET_VALUE",t="vuexfire/ARRAY_ADD",n="vuexfire/ARRAY_REMOVE";function r(e,t){return t.split(".").reduce((function(e,t){return e[t]}),e)}function o(e){return e&&"object"==typeof e}function i(e){return e&&e.onSnapshot}function a(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}var c={reset:!0,serialize:function(e){var t=e.val(),n=o(t)?t:Object.defineProperty({},".value",{value:t});return Object.defineProperty(n,".key",{value:e.key}),n},wait:!1};function u(e,t,n){var r=[{},{}],a=Object.keys(n).reduce((function(e,t){var r=n[t];return e[r.path]=r.data(),e}),{});return function e(t,n,r,c){n=n||{};var u=c[0],f=c[1];for(var s in Object.getOwnPropertyNames(t).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t,e);n&&!n.enumerable&&Object.defineProperty(u,e,n)})),t){var l=t[s];if(null==l||l instanceof Date||l.toDate||l.longitude&&l.latitude)u[s]=l;else if(i(l))u[s]="object"==typeof n&&s in n?n[s]:l.path,f[r+s]=l;else if(Array.isArray(l)){u[s]=Array(l.length);for(var d=0;d<l.length;d++){var v=l[d];v.path in a&&(u[s][d]=a[v.path])}e(l,u[s],r+s+".",[u[s],f])}else o(l)?(u[s]={},e(l,n[s],r+s+".",[u[s],f])):u[s]=l}}(e,t,"",r),r}var f,s={maxRefDepth:2,reset:!0,serialize:function(e){return Object.defineProperty(e.data()||{},"id",{value:e.id})},wait:!1};function l(e){for(var t in e)e[t].unsub()}function d(e,t,n,o,i,a,c,f){var s=u(e.serialize(o),r(t,n),i),l=s[0],d=s[1];a.set(t,n,l),p(e,t,n,i,d,a,c,f)}function v(e,t){var n=e.ref,r=e.target,o=e.path,i=e.depth,a=e.resolve,c=e.ops,u=Object.create(null),f=n.onSnapshot((function(e){e.exists?d(t,r,o,e,u,c,i,a):(c.set(r,o,null),a())}));return function(){f(),l(u)}}function p(e,t,n,o,i,a,c,u){var f=Object.keys(i);if(Object.keys(o).filter((function(e){return f.indexOf(e)<0})).forEach((function(e){o[e].unsub(),delete o[e]})),!f.length||++c>e.maxRefDepth)return u(n);var s=0,l=f.length,d=Object.create(null);function p(e){e in d&&++s>=l&&u(n)}f.forEach((function(u){var f=o[u],s=i[u],l=n+"."+u;if(d[l]=!0,f){if(f.path===s.path)return;f.unsub()}o[u]={data:function(){return r(t,l)},unsub:v({ref:s,target:t,path:l,depth:c,ops:a,resolve:p.bind(null,l)},e),path:s.path}}))}var h=((f={})[e]=function(e,t){var n=t.path;!function(e,t,n){var r=(""+t).split("."),o=r.pop(),i=r.reduce((function(e,t){return e[t]}),e);Array.isArray(i)?i.splice(Number(o),1,n):i[o]=n}(t.target,n,t.data)},f[t]=function(e,t){var n=t.newIndex,r=t.data;t.target.splice(n,0,r)},f[n]=function(e,t){var n=t.oldIndex;return t.target.splice(n,1)[0]},f),y=function(){return(y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},b={root:!0},g=new WeakMap;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function m(e,t,n,r,o,i){var u=g.get(t);return u||(u=Object.create(null),g.set(t,u)),n in u&&j(t,n,i&&i.reset),new Promise((function(t,f){u[n]=Array.isArray(e[n])?function(e,t){var n=e.vm,r=e.key,o=e.collection,i=e.resolve,u=e.reject,f=e.ops;void 0===t&&(t=c);var s=Object.assign({},c,t),l=s.wait?[]:f.set(n,r,[]),d=o.on("child_added",(function(e,t){var n=t?a(l,t)+1:0;f.add(l,n,s.serialize(e))}),u),v=o.on("child_removed",(function(e){f.remove(l,a(l,e.key))}),u),p=o.on("child_changed",(function(e){f.set(l,a(l,e.key),s.serialize(e))}),u),h=o.on("child_moved",(function(e,t){var n=a(l,e.key),r=f.remove(l,n)[0],o=t?a(l,t)+1:0;f.add(l,o,r)}),u);return o.once("value",(function(e){s.wait&&f.set(n,r,l),i(e)})),function(e){if(o.off("child_added",d),o.off("child_changed",p),o.off("child_removed",v),o.off("child_moved",h),!1!==e){var t="function"==typeof e?e():[];f.set(n,r,t)}}}({vm:e,key:n,collection:r,ops:o,resolve:t,reject:f},i):function(e,t){var n=e.vm,r=e.key,o=e.document,i=e.resolve,a=e.reject,u=e.ops;void 0===t&&(t=c);var f=Object.assign({},c,t),s=o.on("value",(function(e){u.set(n,r,f.serialize(e))}),a);return o.once("value",i),function(e){if(o.off("value",s),!1!==e){var t="function"==typeof e?e():null;u.set(n,r,t)}}}({vm:e,key:n,document:r,ops:o,resolve:t,reject:f},i)}))}function j(e,t,n){var r=g.get(e);r&&r[t]&&(r[t](n),delete r[t])}function O(r){return function(o,i){var a=o.state,u=o.commit,f={set:function(t,n,r){return u(e,{path:n,target:t,data:r},b),r},add:function(e,n,r){return u(t,{target:e,newIndex:n,data:r},b)},remove:function(e,t){var r=e[t];return u(n,{target:e,oldIndex:t},b),[r]}};return r.call(this,y(y({},o),{bindFirebaseRef:function(e,t,n){return m(a,u,e,t,f,Object.assign({},c,n))},unbindFirebaseRef:function(e,t){return j(u,e,t)}}),i)}}var w={root:!0},k=new WeakMap;function x(e,t,n,o,i,a){var c=k.get(t);return c||(c=Object.create(null),k.set(t,c)),n in c&&A(t,n,a.wait?"function"==typeof a.reset&&a.reset:a.reset),new Promise((function(t,f){c[n]="where"in o?function(e,t){var n=e.vm,r=e.key,o=e.collection,i=e.ops,a=e.resolve,c=e.reject;void 0===t&&(t=s);var f,d=Object.assign({},s,t),v=d.wait?[]:i.set(n,r,[]),h=a,y=[],b={added:function(e){var t=e.newIndex,n=e.doc;y.splice(t,0,Object.create(null));var r=y[t],o=u(d.serialize(n),void 0,r),c=o[0],f=o[1];i.add(v,t,c),p(d,v,t,r,f,i,0,a.bind(null,n))},modified:function(e){var t=e.oldIndex,n=e.newIndex,r=e.doc,o=y[t],c=v[t],f=u(d.serialize(r),c,o),s=f[0],l=f[1];y.splice(n,0,o),i.remove(v,t),i.add(v,n,s),p(d,v,n,o,l,i,0,a)},removed:function(e){var t=e.oldIndex;i.remove(v,t),l(y.splice(t,1)[0])}},g=o.onSnapshot((function(e){var t="function"==typeof e.docChanges?e.docChanges():e.docChanges;if(!f&&t.length){f=!0;for(var o=0,c=t.length,u=Object.create(null),s=0;s<c;s++)u[t[s].doc.id]=!0;a=function(e){e.id in u&&++o>=c&&(d.wait&&i.set(n,r,v),h(n[r]),a=function(){})}}t.forEach((function(e){b[e.type](e)})),t.length||(d.wait&&i.set(n,r,v),a(v))}),c);return function(e){if(g(),!1!==e){var t="function"==typeof e?e():[];i.set(n,r,t)}y.forEach(l)}}({vm:e,key:n,collection:o,ops:i,resolve:t,reject:f},a):function(e,t){var n=e.vm,o=e.key,i=e.document,a=e.resolve,c=e.reject,u=e.ops;void 0===t&&(t=s);var f,v,p,h=Object.assign({},s,t),y=Object.create(null);f=a,v=function(){return r(n,o)},p=!1,a=function(){if(!p)return p=!0,f(v())};var b=i.onSnapshot((function(e){e.exists?d(h,n,o,e,y,u,0,a):(u.set(n,o,null),a(null))}),c);return function(e){if(b(),!1!==e){var t="function"==typeof e?e():null;u.set(n,o,t)}l(y)}}({vm:e,key:n,document:o,ops:i,resolve:t,reject:f},a)}))}function A(e,t,n){var r=k.get(e);r&&r[t]&&(r[t](n),delete r[t])}function R(r){return function(o,i){var a=o.state,c=o.commit,u={set:function(t,n,r){return c(e,{path:n,target:t,data:r},w),r},add:function(e,n,r){return c(t,{target:e,newIndex:n,data:r},w)},remove:function(e,t){var r=e[t];return c(n,{target:e,oldIndex:t},w),[r]}};return r.call(this,y(y({},o),{bindFirestoreRef:function(e,t,n){return x(a,c,e,t,u,Object.assign({},s,n))},unbindFirestoreRef:function(e,t){return A(c,e,t)}}),i)}}export{O as firebaseAction,R as firestoreAction,s as firestoreOptions,c as rtdbOptions,h as vuexfireMutations};
